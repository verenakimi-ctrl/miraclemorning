<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MiracleMorning</title>
  <style>
    body { margin:0; font-family: system-ui, Arial, sans-serif; background:#f7f7fb; color:#222; }
    header { background:#6a5acd; color:#fff; padding:20px; text-align:center; }
    main { max-width:800px; margin:24px auto; padding:0 16px; }
    .card { background:#fff; border:1px solid #eee; border-radius:12px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,.06); }
    h1 { margin:0; }
    .muted { color:#666; }
    footer { text-align:center; padding:24px; color:#888; }
    a.btn { display:inline-block; padding:10px 16px; border-radius:8px; text-decoration:none; border:1px solid #6a5acd; color:#6a5acd; }
    a.btn:hover { background:#6a5acd; color:#fff; }
  </style>
</head>
<body>
  <header>
    <h1>🌅 MiracleMorning</h1>
    <div class="muted">Daily routine tracker (Pi Hackathon)</div>
  </header>

  <main>
    <div class="card">
      <h2>Welcome!</h2>
      <p>This is a simple home page deployed on Vercel.</p>
      <p class="muted">Next: connect this URL in Pi Developer Portal (Step 5).</p>
      <a class="btn" href="#" onclick="alert('Coming soon!')">Start</a>
    </div>
  </main>

  <footer>© 2025 MiracleMorning</footer>

  <!-- Pi SDK 포함 -->
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <script>
    // Pi SDK 초기화 (테스트용 sandbox 모드)
    Pi.init({ version: "2.0", sandbox: true });

    // 인증 함수
    async function ensureAuth() {
      try {
        await Pi.authenticate(["payments"], (p) => console.log("incomplete payment:", p));
        console.log("✅ Authenticated with payments scope");
      } catch (e) {
        console.error("Auth failed:", e?.message || e);
        alert("Authentication failed. Check console for details.");
      }
    }

    // 결제 테스트 함수
    async function testPayment() {
      try {
        const paymentData = {
          amount: 0.01,
          memo: "MiracleMorning test payment",
          metadata: { source: "demo" },
        };

        const callbacks = {
          onReadyForServerApproval: (paymentId) => {
            console.log("Server approval needed for:", paymentId);
            // 실제 서버 API 호출 (미구현 시 주석 처리)
            // fetch("/api/approve", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ paymentId }) });
          },
          onReadyForServerCompletion: (paymentId, txid) => {
            console.log("Payment completed:", paymentId, txid);
            // fetch("/api/complete", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ paymentId, txid }) });
          },
          onCancel: () => alert("Payment cancelled"),
          onError: (err) => alert("❌ Payment failed: " + (err?.message || err)),
        };

        const payment = await Pi.createPayment(paymentData, callbacks);
        alert("✅ Payment created: " + (payment?.identifier || ""));
      } catch (err) {
        alert("❌ Payment failed: " + (err?.message || err));
      }
    }

    // 페이지 로드 시 인증 시도 (선택 사항)
    window.onload = ensureAuth;

    // 버튼 추가
    document.body.insertAdjacentHTML('beforeend', `
      <div style="text-align:center; margin-top:20px;">
        <button onclick="testPayment()" style="padding:10px 20px; font-size:16px; background:#6a5acd; color:#fff; border:none; border-radius:6px;">
          Test Pi Payment
        </button>
      </div>
    `);
  </script>
</body>
</html>
