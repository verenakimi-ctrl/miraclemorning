<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MiracleMorning</title>
  <style>
    body { margin:0; font-family: system-ui, Arial, sans-serif; background:#f7f7fb; color:#222; }
    header { background:#6a5acd; color:#fff; padding:20px; text-align:center; }
    main { max-width:800px; margin:24px auto; padding:0 16px; }
    .card { background:#fff; border:1px solid #eee; border-radius:12px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,.06); }
    h1 { margin:0; }
    .muted { color:#666; }
    footer { text-align:center; padding:24px; color:#888; }
    a.btn { display:inline-block; padding:10px 16px; border-radius:8px; text-decoration:none; border:1px solid #6a5acd; color:#6a5acd; }
    a.btn:hover { background:#6a5acd; color:#fff; }
  </style>
</head>
<body>
  <header>
    <h1>üåÖ MiracleMorning</h1>
    <div class="muted">Daily routine tracker (Pi Hackathon)</div>
  </header>

  <main>
    <div class="card">
      <h2>Welcome!</h2>
      <p>This is a simple home page deployed on Vercel.</p>
      <p class="muted">Next: connect this URL in Pi Developer Portal (Step 5).</p>
      <a class="btn" href="#" onclick="alert('Coming soon!')">Start</a>
    </div>
  </main>

  <footer>¬© 2025 MiracleMorning</footer>
  <footer>¬© 2025 MiracleMorning</footer>

  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <script>
    Pi.init({ version: "2.0" });
<!-- (head ÏïàÏóê Ïù¥ÎØ∏ ÏóÜÎã§Î©¥) SDK Ïä§ÌÅ¨Î¶ΩÌä∏ -->
<script src="https://sdk.minepi.com/pi-sdk.js"></script>

<script>
  // Pi SDK Ï¥àÍ∏∞Ìôî (Pi Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú Ïã§ÌñâÌï† Îïå sandbox:false)
  Pi.init({ version: "2.0", sandbox: false });

  // ÌéòÏù¥ÏßÄ Î°úÎìú Îïå Í≤∞Ï†ú Ïä§ÏΩîÌîÑ Ïù∏Ï¶ù
  async function ensureAuth() {
    try {
      await Pi.authenticate(["payments"], function onIncompletePaymentFound(p) {
        console.log("incomplete payment:", p);
      });
      console.log("‚úÖ authenticated with payments scope");
    } catch (e) {
      alert("Auth failed: " + (e?.message || e));
    }
  }
  ensureAuth();

  // Í≤∞Ï†ú ÌÖåÏä§Ìä∏ Î≤ÑÌäºÏóêÏÑú Ìò∏Ï∂úÌï† Ìï®Ïàò
  async function testPayment() {
    try {
      const paymentData = {
        amount: 0.01, // ÌÖåÏä§Ìä∏ Í∏àÏï°
        memo: "MiracleMorning test payment",
        metadata: { source: "demo" },
      };

      const callbacks = {
        onReadyForServerApproval: (paymentId) =>
          fetch("/api/approve", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ paymentId }),
          }),
        onReadyForServerCompletion: (paymentId, txid) =>
          fetch("/api/complete", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ paymentId, txid }),
          }),
        onCancel: () => alert("Payment cancelled"),
        onError: (err) => alert("‚ùå " + (err?.message || err)),
      };

      const payment = await Pi.createPayment(paymentData, callbacks);
      alert("‚úÖ Payment created: " + (payment?.identifier || ""));
    } catch (err) {
      alert("‚ùå Payment failed: " + (err?.message || err));
    }
  }
</script>

  <div style="text-align:center; margin-top:20px;">
    <button onclick="testPayment()" 
      style="padding:10px 20px; font-size:16px; background:#6a5acd; color:#fff; border:none; border-radius:6px;">
      Test Pi Payment
    </button>
  </div>
</body>
</html>
